import "pe"
import "math"

rule possibly_packed {
	meta:
		description = "Rule to detect binaries with a big difference between section size and section vsize (after unpack). Also, it includes a big entropy and executable flags"
	condition:
		for any i in ( 0..pe.number_of_sections - 1):(
			(pe.sections[i].virtual_size > pe.sections[i].raw_data_size*2)
			and
			pe.sections[i].characteristics & SECTION_MEM_EXECUTE
			and
			math.entropy(pe.sections[i].raw_data_offset, r2.section[i].raw_data_size) >= 7
		)
}
