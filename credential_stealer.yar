import "pe"

rule hash_dumping {
    meta:
        author="gr3yc4t"
        version="0.1"
        description="Check if common technique for \"pass the hash \" attack are present"
    strings:
        //Pwdump
        $lsass = "lsass"
        $getHash = "GetHash"
        $advapi = "advapi32.dll"
        $samLibrary = "samsrv.dll"
        $samQuery = "SamrQueryInformationUser"
        $samGet = "SamrQueryInformationUser"
    condition: 
        ($samLibrary and $samQuery and $samGet)
        or
        (
            $lsass and $getHash and $advapi
        )

}